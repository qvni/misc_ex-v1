IF
	!GlobalTimerNotExpired("castspell","LOCALS")
	HaveSpell(ROGUE_EVASION)  // SPCL913.SPL (Quick Attacks)
	See(NearestEnemyOf(Myself))
	OR(2)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(2)
		DifficultyGT(EASY)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(3)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",3)
		HasItem("dw#mkhla",Myself)  // Mirror
	OR(3)
		DifficultyGT(NORMAL)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",3)
		HasItem("dw#mkhla",Myself)  // Mirror
	Allegiance(Myself,ENEMY)
	!Allegiance(NearestEnemyOf(Myself),ENEMY)
	!StateCheck(NearestEnemyOf(Myself),STATE_DISABLED)
	!CheckStatGT(NearestEnemyOf(Myself),0,HELD)
	!StateCheck(NearestEnemyOf(Myself),STATE_MIRRORIMAGE)
	OR(2)
		WeaponEffectiveVs(NearestEnemyOf(Myself),MAINHAND)
		GlobalTimerNotExpired("seedefences","LOCALS")
	OR(2)
		WeaponCanDamage(NearestEnemyOf(Myself),MAINHAND)
		GlobalTimerNotExpired("seedefences","LOCALS")
	CheckStatLT(NearestEnemyOf(Myself),100,RESISTSLASHING)
	OR(2)
		CheckStatLT(NearestEnemyOf(Myself),75,RESISTSLASHING)
		GlobalTimerNotExpired("targetcompromise","LOCALS")
	!CheckStat(Myself,4,OFFENSIVE_MODIFIER)
	CheckStatGT(NearestEnemyOf(Myself),8,LEVEL)
	Range(NearestEnemyOf(Myself),5)
	See(NearestEnemyOf(Myself))
	Range(NearestEnemyOf(Myself),5)
	!StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobalTimer("castspell","LOCALS",THREE_ROUNDS)
		Spell(Myself,ROGUE_EVASION)  // SPCL913.SPL (Quick Attacks)
END

IF
	!GlobalTimerNotExpired("castspell","LOCALS")
	HaveSpell(ROGUE_EVASION)  // SPCL913.SPL (Quick Attacks)
	See(SecondNearestEnemyOf(Myself))
	OR(2)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(2)
		DifficultyGT(EASY)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(3)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",3)
		HasItem("dw#mkhla",Myself)  // Mirror
	OR(3)
		DifficultyGT(NORMAL)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",3)
		HasItem("dw#mkhla",Myself)  // Mirror
	Allegiance(Myself,ENEMY)
	!Allegiance(SecondNearestEnemyOf(Myself),ENEMY)
	!StateCheck(SecondNearestEnemyOf(Myself),STATE_DISABLED)
	!CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
	!StateCheck(SecondNearestEnemyOf(Myself),STATE_MIRRORIMAGE)
	OR(2)
		WeaponEffectiveVs(SecondNearestEnemyOf(Myself),MAINHAND)
		GlobalTimerNotExpired("seedefences","LOCALS")
	OR(2)
		WeaponCanDamage(SecondNearestEnemyOf(Myself),MAINHAND)
		GlobalTimerNotExpired("seedefences","LOCALS")
	CheckStatLT(SecondNearestEnemyOf(Myself),100,RESISTSLASHING)
	OR(2)
		CheckStatLT(SecondNearestEnemyOf(Myself),75,RESISTSLASHING)
		GlobalTimerNotExpired("targetcompromise","LOCALS")
	!CheckStat(Myself,4,OFFENSIVE_MODIFIER)
	CheckStatGT(SecondNearestEnemyOf(Myself),8,LEVEL)
	Range(SecondNearestEnemyOf(Myself),5)
	See(SecondNearestEnemyOf(Myself))
	Range(NearestEnemyOf(Myself),5)
	!StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobalTimer("castspell","LOCALS",THREE_ROUNDS)
		Spell(Myself,ROGUE_EVASION)  // SPCL913.SPL (Quick Attacks)
END

IF
	!GlobalTimerNotExpired("castspell","LOCALS")
	HaveSpell(ROGUE_EVASION)  // SPCL913.SPL (Quick Attacks)
	See(ThirdNearestEnemyOf(Myself))
	OR(2)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(2)
		DifficultyGT(EASY)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(3)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",3)
		HasItem("dw#mkhla",Myself)  // Mirror
	OR(3)
		DifficultyGT(NORMAL)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",3)
		HasItem("dw#mkhla",Myself)  // Mirror
	Allegiance(Myself,ENEMY)
	!Allegiance(ThirdNearestEnemyOf(Myself),ENEMY)
	!StateCheck(ThirdNearestEnemyOf(Myself),STATE_DISABLED)
	!CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
	!StateCheck(ThirdNearestEnemyOf(Myself),STATE_MIRRORIMAGE)
	OR(2)
		WeaponEffectiveVs(ThirdNearestEnemyOf(Myself),MAINHAND)
		GlobalTimerNotExpired("seedefences","LOCALS")
	OR(2)
		WeaponCanDamage(ThirdNearestEnemyOf(Myself),MAINHAND)
		GlobalTimerNotExpired("seedefences","LOCALS")
	CheckStatLT(ThirdNearestEnemyOf(Myself),100,RESISTSLASHING)
	OR(2)
		CheckStatLT(ThirdNearestEnemyOf(Myself),75,RESISTSLASHING)
		GlobalTimerNotExpired("targetcompromise","LOCALS")
	!CheckStat(Myself,4,OFFENSIVE_MODIFIER)
	CheckStatGT(ThirdNearestEnemyOf(Myself),8,LEVEL)
	Range(ThirdNearestEnemyOf(Myself),5)
	See(ThirdNearestEnemyOf(Myself))
	Range(NearestEnemyOf(Myself),5)
	!StateCheck(Myself,STATE_INVISIBLE)
THEN
	RESPONSE #100
		SetGlobalTimer("castspell","LOCALS",THREE_ROUNDS)
		Spell(Myself,ROGUE_EVASION)  // SPCL913.SPL (Quick Attacks)
END

IF
	!GlobalTimerNotExpired("castspell","LOCALS")
	HaveSpell(ROGUE_GREATER_EVASION)  // Potion of Invisibility
	!General(Myself,UNDEAD)
	OR(2)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(2)
		DifficultyGT(EASY)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	!StateCheck(Myself,STATE_INVISIBLE)
	See(NearestEnemyOf(Myself))
	!CheckSpellState(Myself,CANNOT_TURN_INVISIBLE)
	!GlobalTimerNotExpired("thief_detection","LOCALS")
THEN
	RESPONSE #200
		SetGlobalTimer("castspell","LOCALS",TWO_ROUNDS)
		Spell(Myself,ROGUE_GREATER_EVASION)
		UseItem("potn10",Myself)  // Potion of Invisibility
		Wait(1)
		SetGlobal("backstabplan","LOCALS",1)
		SetGlobalTimer("backstabtimer","LOCALS",ONE_ROUND)
	RESPONSE #100
		Continue()
END


IF
	!GlobalTimerNotExpired("castspell","LOCALS")
	HaveSpell(AVOID_DEATH)
	OR(2)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(2)
		DifficultyGT(EASY)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",2)
	OR(3)
		Global("DMWW_genai_difficulty","GLOBAL",0)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",3)
		HasItem("dw#mkhla",Myself)  // Mirror
	OR(3)
		DifficultyGT(NORMAL)
		GlobalGT("DMWW_genai_difficulty","GLOBAL",3)
		HasItem("dw#mkhla",Myself)  // Mirror
	See(NearestEnemyOf(Myself))
	Range(NearestEnemyOf(Myself),5)
	OR(2)
		!CheckSpellState(Myself,Y5ROGAD)
THEN
	RESPONSE #100
		SetGlobalTimer("castspell","LOCALS",ONE_ROUND)
		SetInterrupt(FALSE)
		ApplySpellRes("y5rogad",Myself)
		SetInterrupt(TRUE)
		Spell(Myself,AVOID_DEATH)
END